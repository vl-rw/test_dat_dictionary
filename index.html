<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>English sentences</title>
<style>
body {background-color: grey; margin: auto; padding: 20%;}
textarea {height: 50px;width: 500px;padding: 10px;border-radius:5px;}
</style>
</head>
<body>
    
    <form method="POST" action="/">
    	<h2>Предложение</h2>
        <textarea id="ms1" name="message1" required></textarea><br>
    	<h2>Sentence</h2>
        <textarea id="ms2" name="message2" required></textarea><br>
    	<h2>Input from a user</h2>
        <textarea id="ms3" name="message3" required></textarea><br>
    </form>
<button onclick="pressed_btn(this)" id="b1"></button>
<button onclick="pressed_btn(this)" id="b2"></button>
<button onclick="pressed_btn(this)" id="b3"></button>
<button onclick="pressed_btn(this)" id="b4"></button><br>

<button onclick="pressed_btn(this)" id="b5"></button>
<button onclick="pressed_btn(this)" id="b6"></button>
<button onclick="pressed_btn(this)" id="b7"></button>
<button onclick="pressed_btn(this)" id="b8"></button><br><br><br><br>


<button onclick="test()">CHECK</button>


<script>

function test() {
if ((ms2.value+' ') == ms3.value) {
		alert ('You are right!');
		location.reload();
	}else {
		alert ('WRONG!');
		ms3.value = '';
	};
}

function pressed_btn(id) {
	//console.log(id);
	ms3.value += id.textContent + ' ';
}




fetch('sentences.json')

.then(response => {
	if (!response.ok) throw new Error('sentences.json is fucked');
	return response.json();
})

.then(data =>{
	const list = data;

	function get_a_line() {
		return Math.round(50*Math.random());
	};

	line = get_a_line();
	ms1.value = list[line]["russian"];
	ms2.value = list[line]["english"];

	let arr = list[line]["english"].split(" ");


	arr.forEach(function(item, index) {
		//console.log(`${index}: ${item}`);
	});

	let randomSent = ' '+list[get_a_line()]["english"];
	randomSent += ' '+list[get_a_line()]["english"];
	randomSent += ' '+list[get_a_line()]["english"];
	randomSent += ' '+list[get_a_line()]["english"];
	randomSent += ' '+list[get_a_line()]["english"]

	let pool = randomSent.split(' ');
	pool.splice(0, 1);
	console.log(pool);


	async function prolongating(arr, pool) {
		const result = arr;
		const available = pool; // копируем пул, чтобы не портить оригинал
  		while (result.length < 8) {
			// Случайный индекс из оставшихся в пуле
			const randIndex = Math.floor(Math.random() * available.length);
			const word = available[randIndex];
			//console.log(randIndex)
			//console.log(available[randIndex])
    
    		result.push(word);
    		available.splice(randIndex, 1); // удаляем использованное слово из пула
 		};
  
		//console.log(result);
  		return result;
	};

	final_arr =  prolongating(arr, pool)
		.then(data => {
    			console.log(data);
			let buttons = ['b1', 'b2', 'b3', 'b4', 'b5', 'b6', 'b7', 'b8'];

			let i=0;

				//let r;

			while (buttons.length > 0) {
  				//let r=buttons.length + Math.round(Math.random()-1) ;
				let r=Math.floor(buttons.length*Math.random());
				console.log(r);
				let el = document.getElementById(buttons[r]);
				if (el == null) el = document.getElementById(buttons[r-1]);
				console.log(el);
				el.textContent = data[i];
				console.log(data[i]);
				console.log(buttons);
				buttons.splice(r,1);
				console.log(buttons);
				i++;
			};
  		})


  .catch(error => console.error('Ошибка:', error));
})

.catch(error => {
console.error(error);
});

</script>
</body>
</html>

